# çŸ­é“¾æ¥æœåŠ¡ (Short Link V2.0)

ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ URL ç¼©çŸ­æœåŠ¡ï¼ŒåŸºäº Vue 3ã€Fastifyã€Vercel å’Œ Supabase æ„å»ºã€‚

> æ³¨æ„ï¼š
>
> å½“å‰ V2.0 ç‰ˆæœ¬ç”±äºæ›´æ–°å†…å®¹è¾ƒå¤šï¼Œå¯¼è‡´æµ‹è¯•è¦†ç›–ä¸å…¨ï¼Œä»¥åŠéƒ¨åˆ†åŠŸèƒ½æ²¡æœ‰å®Œå…¨å®ç°

## ğŸ“– æ¦‚è¿°

çŸ­é“¾æ¥æœåŠ¡å…è®¸ç”¨æˆ·å¿«é€Ÿç¼©çŸ­ URLï¼Œä¾¿äºåˆ†äº«å’Œç®¡ç†ã€‚æ”¯æŒåŒ¿ååˆ›å»ºå’Œç”¨æˆ·ç™»å½•åçš„é“¾æ¥ç®¡ç†ï¼Œæä¾›ä¸°å¯Œçš„é“¾æ¥é…ç½®é€‰é¡¹å’Œè¯¦ç»†çš„è®¿é—®ç»Ÿè®¡ã€‚

> æ³¨æ„ï¼š
>
> å½“å‰ V2.0 ç‰ˆæœ¬ï¼Œä¸ V1.0 ç‰ˆæœ¬æœ‰è¾ƒå¤§çš„æ›´æ–°ï¼Œä¸‹é¢çš„æ•™ç¨‹ç›®å‰ä¸èƒ½å®Œå…¨è¦†ç›–éƒ¨ç½²è¿‡ç¨‹ï¼Œv2.0 éƒ¨ç½²æ•™ç¨‹æ­£åœ¨ç­¹å¤‡ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

### V1.0 éƒ¨ç½²æ•™ç¨‹

- ğŸ“ å®ç°åŸç†ï¼š[åŠä¸ªå°æ—¶ï¼Œæˆ‘å¼€å‘äº†ä¸ªçŸ­é“¾æ¥æœåŠ¡](https://juejin.cn/post/7511983823259189287)
- ğŸš€ éƒ¨ç½²æ•™ç¨‹ï¼š[ä»é›¶æ­å»ºä¸€ä¸ªå…è´¹ç¨³å®šçš„ç§æœ‰çŸ­é“¾æ¥æœåŠ¡](https://juejin.cn/post/7511671401683992587)

## ğŸŒ åœ¨çº¿ä½“éªŒ

è®¿é—® [https://short.pangcy.cn](https://short.pangcy.cn) ä½“éªŒå®Œæ•´åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **çŸ­é“¾æ¥ç”Ÿæˆ**ï¼šå¿«é€Ÿå°†é•¿é“¾æ¥è½¬æ¢ä¸ºçŸ­é“¾æ¥
- **äºŒç»´ç ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”ŸæˆçŸ­é“¾æ¥å¯¹åº”çš„äºŒç»´ç 
- **é“¾æ¥æœ‰æ•ˆæœŸ**ï¼šå¯è®¾ç½®é“¾æ¥è¿‡æœŸæ—¶é—´
- **è®¿é—®æ¬¡æ•°é™åˆ¶**ï¼šå¯è®¾ç½®æœ€å¤§è®¿é—®æ¬¡æ•°
- **å¯†ç ä¿æŠ¤**ï¼šä¸ºé“¾æ¥è®¾ç½®è®¿é—®å¯†ç 

### é«˜çº§åŠŸèƒ½
- **è®¿é—®ç»Ÿè®¡**ï¼šè¯¦ç»†çš„ç‚¹å‡»é‡ã€æ¥æºã€è®¾å¤‡ç­‰ç»Ÿè®¡åˆ†æ
- **è®¿é—®é™åˆ¶**ï¼š
  - IP ç™½åå•/é»‘åå•
  - è®¾å¤‡ç±»å‹é™åˆ¶ï¼ˆç§»åŠ¨ç«¯/å¹³æ¿/æ¡Œé¢ç«¯ï¼‰
  - æ¥æºåŸŸåé™åˆ¶
  - å›½å®¶/åœ°åŒºé™åˆ¶
- **é‡å®šå‘é…ç½®**ï¼šæ”¯æŒ 301/302/307/308 å¤šç§é‡å®šå‘ç±»å‹
- **æŸ¥è¯¢å‚æ•°é€ä¼ **ï¼šå¯é€‰æ‹©æ˜¯å¦å°†åŸé“¾æ¥å‚æ•°ä¼ é€’ç»™ç›®æ ‡ URL
- **è¯·æ±‚å¤´è½¬å‘**ï¼šæ”¯æŒè‡ªå®šä¹‰è½¬å‘è¯·æ±‚å¤´

### ç”¨æˆ·åŠŸèƒ½
- **ç”¨æˆ·è®¤è¯**ï¼šæ”¯æŒé‚®ç®±æ³¨å†Œç™»å½•ã€OAuth ç¬¬ä¸‰æ–¹ç™»å½•
- **é“¾æ¥ç®¡ç†**ï¼šæŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ä¸ªäººåˆ›å»ºçš„é“¾æ¥
- **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡å¯ç”¨/ç¦ç”¨ã€åˆ é™¤é“¾æ¥
- **æ•°æ®çœ‹æ¿**ï¼šä¸ªäººé“¾æ¥ç»Ÿè®¡æ¦‚è§ˆ
- **çƒ­é—¨æ’è¡Œ**ï¼šæŸ¥çœ‹ç‚¹å‡»é‡æœ€é«˜çš„é“¾æ¥

### ç®¡ç†å‘˜åŠŸèƒ½
- **å…¨å±€ç»Ÿè®¡**ï¼šå…¨ç«™é“¾æ¥æ•°ã€ç‚¹å‡»æ•°ã€ç”¨æˆ·æ•°ç­‰ç»Ÿè®¡
- **ç”¨æˆ·ç®¡ç†**ï¼šæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ã€ç¦ç”¨/è§£ç¦ç”¨æˆ·ã€é‡ç½®å¯†ç 
- **é“¾æ¥å®¡æ ¸**ï¼šç®¡ç†æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬åŒ¿åç”¨æˆ·ï¼‰åˆ›å»ºçš„é“¾æ¥
- **ç™»å½•æ—¥å¿—**ï¼šæŸ¥çœ‹ç”¨æˆ·ç™»å½•è®°å½•å’Œå¼‚å¸¸æ£€æµ‹
- **è®¿é—®æ—¥å¿—**ï¼šæŸ¥çœ‹æ‰€æœ‰é“¾æ¥çš„è¯¦ç»†è®¿é—®è®°å½•

## ğŸ›  æŠ€æœ¯æ ˆ

### å‰ç«¯
- **Vue 3** - æ¸è¿›å¼ JavaScript æ¡†æ¶
- **Pinia** - Vue çŠ¶æ€ç®¡ç†
- **Vue Router** - è·¯ç”±ç®¡ç†
- **Arco Design Vue** - UI ç»„ä»¶åº“
- **TailwindCSS 4** - åŸå­åŒ– CSS æ¡†æ¶
- **Vite 7** - ä¸‹ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·

### åç«¯
- **Fastify 5** - é«˜æ€§èƒ½ Node.js Web æ¡†æ¶
- **Supabase** - å¼€æº Firebase æ›¿ä»£å“ï¼ˆPostgreSQL æ•°æ®åº“ + è®¤è¯ï¼‰
- **nanoid** - çŸ­é“¾æ¥ ID ç”Ÿæˆ

### éƒ¨ç½²
- **Vercel** - è¾¹ç¼˜éƒ¨ç½²å¹³å°ï¼ˆServerless Functionsï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

```
short-link/
â”œâ”€â”€ api/                    # Vercel Serverless å…¥å£
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ server/                 # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ middlewares/        # ä¸­é—´ä»¶ï¼ˆè®¤è¯ã€é”™è¯¯å¤„ç†ç­‰ï¼‰
â”‚   â”œâ”€â”€ routes/             # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ templates/          # æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ types/              # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ src/                    # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ assets/             # é™æ€èµ„æº
â”‚   â”œâ”€â”€ components/         # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ composables/        # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ services/           # API æœåŠ¡
â”‚   â”œâ”€â”€ stores/             # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ types/              # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ views/              # é¡µé¢ç»„ä»¶
â”‚       â”œâ”€â”€ account/        # è´¦å·ç›¸å…³
â”‚       â”œâ”€â”€ dashboard/      # æ§åˆ¶å°
â”‚       â”‚   â”œâ”€â”€ admin/      # ç®¡ç†å‘˜é¡µé¢
â”‚       â”‚   â”œâ”€â”€ links/      # é“¾æ¥ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ profile/    # ä¸ªäººä¿¡æ¯
â”‚       â”‚   â””â”€â”€ stats/      # æ•°æ®ç»Ÿè®¡
â”‚       â”œâ”€â”€ error/          # é”™è¯¯é¡µé¢
â”‚       â”œâ”€â”€ home/           # é¦–é¡µ
â”‚       â”œâ”€â”€ login/          # ç™»å½•
â”‚       â”œâ”€â”€ password/       # å¯†ç éªŒè¯
â”‚       â””â”€â”€ register/       # æ³¨å†Œ
â”œâ”€â”€ config/                 # é¡¹ç›®é…ç½®
â”œâ”€â”€ types/                  # å…¨å±€ç±»å‹å®šä¹‰
â”œâ”€â”€ supabase/               # Supabase é…ç½®
â””â”€â”€ public/                 # å…¬å…±é™æ€èµ„æº
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

- Node.js 18+
- pnpm
- Vercel CLI
- Supabase é¡¹ç›®

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/Alessandro-Pang/short-link.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd short-link

# å®‰è£…ä¾èµ–
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

1. å…¨å±€å®‰è£… Vercel CLIï¼š

   ```bash
   npm install -g vercel@latest
   ```

2. å…³è” Vercel é¡¹ç›®ï¼š

   ```bash
   vercel link
   ```

3. æ‹‰å–ç¯å¢ƒå˜é‡ï¼š

   ```bash
   vercel env pull .env.development.local
   ```

### æœ¬åœ°å¼€å‘

```bash
# åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯å¼€å‘æœåŠ¡å™¨
pnpm dev

# ä»…å¯åŠ¨å‰ç«¯
pnpm dev:web

# ä»…å¯åŠ¨åç«¯
pnpm dev:api
```

å¼€å‘æœåŠ¡å™¨å¯åŠ¨åï¼š
- å‰ç«¯ï¼šhttp://localhost:5173
- åç«¯ APIï¼šhttp://localhost:3000
- API æ–‡æ¡£ï¼šhttp://localhost:3000/api/docsï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

### æ„å»ºéƒ¨ç½²

```bash
# æ„å»ºå‰ç«¯
pnpm build

# ç±»å‹æ£€æŸ¥
pnpm type-check
```

## âš™ï¸ ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | å¿…éœ€ |
|--------|------|------|
| `SUPABASE_URL` | Supabase é¡¹ç›® URL | âœ… |
| `SUPABASE_ANON_KEY` | Supabase åŒ¿å Key | âœ… |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase æœåŠ¡ç«¯ Key | âœ… |
| `VITE_SUPABASE_URL` | å‰ç«¯ Supabase URL | âœ… |
| `VITE_SUPABASE_ANON_KEY` | å‰ç«¯ Supabase Key | âœ… |
| `ALLOWED_ORIGINS` | CORS å…è®¸çš„åŸŸåï¼ˆé€—å·åˆ†éš”ï¼‰ | âŒ |
| `DEV_SERVER_PORT` | å¼€å‘æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤ 3000ï¼‰ | âŒ |

## ğŸ‘‘ ç®¡ç†å‘˜è®¾ç½®

ç®¡ç†å‘˜è´¦å·éœ€è¦åœ¨ Supabase æ•°æ®åº“ä¸­æ‰‹åŠ¨è®¾ç½®ã€‚

**æ–¹å¼ä¸€ï¼šé€šè¿‡ Table Editorï¼ˆæ¨èï¼‰**

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. è¿›å…¥ä½ çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§èœå• **Table Editor**
4. é€‰æ‹© `user_profiles` è¡¨
5. æ‰¾åˆ°è¦è®¾ç½®ä¸ºç®¡ç†å‘˜çš„ç”¨æˆ·
6. å‹¾é€‰ `is_admin` å­—æ®µï¼ˆè®¾ä¸º `true`ï¼‰

**æ–¹å¼äºŒï¼šé€šè¿‡ SQL Editor**

```sql
-- è®¾ç½®ç®¡ç†å‘˜ï¼ˆå°† UUID æ›¿æ¢ä¸ºå®é™…ç”¨æˆ· IDï¼‰
UPDATE user_profiles SET is_admin = true WHERE id = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';

-- å–æ¶ˆç®¡ç†å‘˜
UPDATE user_profiles SET is_admin = false WHERE id = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';

-- æŸ¥çœ‹æ‰€æœ‰ç®¡ç†å‘˜
SELECT * FROM user_profiles WHERE is_admin = true;
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### é€Ÿç‡é™åˆ¶

| æ¥å£ç±»å‹ | é™åˆ¶ |
|----------|------|
| å…¨å±€ | 100 æ¬¡/åˆ†é’Ÿ |
| åˆ›å»ºçŸ­é“¾æ¥ | 10 æ¬¡/åˆ†é’Ÿ |
| ç™»å½•ç›¸å…³ | 5 æ¬¡/åˆ†é’Ÿ |
| ç®¡ç†å‘˜æ¥å£ | 50 æ¬¡/åˆ†é’Ÿ |
| æ‰¹é‡æ“ä½œ | 20 æ¬¡/åˆ†é’Ÿ |
| çŸ­é“¾æ¥è·³è½¬ | 200 æ¬¡/åˆ†é’Ÿ |

### SSRF ä¿æŠ¤

- ç¦æ­¢å†…ç½‘åœ°å€å’Œç§æœ‰ IP
- ç¦æ­¢å±é™©ç«¯å£ï¼ˆ22, 3306, 5432, 6379 ç­‰ï¼‰
- ç¦æ­¢äº‘æœåŠ¡å…ƒæ•°æ®ç«¯ç‚¹
- ç¦æ­¢å±é™©åè®®ï¼ˆjavascript, data, file ç­‰ï¼‰

## ğŸ“¸ ç•Œé¢é¢„è§ˆ

### ç”¨æˆ·ç«¯

| | |
|:---:|:---:|
| ![ç”¨æˆ·ç«¯-é¦–é¡µ](./readme/client-01.png) | ![ç”¨æˆ·ç«¯-é“¾æ¥ç®¡ç†](./readme/client-02.png) |
| ![ç”¨æˆ·ç«¯-é“¾æ¥è¯¦æƒ…](./readme/client-03.png) | ![ç”¨æˆ·ç«¯-æ•°æ®ç»Ÿè®¡](./readme/client-04.png) |

### ç®¡ç†å‘˜

| | |
|:---:|:---:|
| ![ç®¡ç†å‘˜-å…¨å±€ç»Ÿè®¡](./readme/server-01.png) | ![ç®¡ç†å‘˜-é“¾æ¥ç®¡ç†](./readme/server-02.png) |
| ![ç®¡ç†å‘˜-ç™»å½•æ—¥å¿—](./readme/server-03.png) | ![ç®¡ç†å‘˜-ç”¨æˆ·ç®¡ç†](./readme/server-04.png) |


## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯· Fork ä»“åº“å¹¶æäº¤ Pull Requestã€‚

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜… [LICENSE](./LICENSE) æ–‡ä»¶ã€‚

## ğŸ“§ è”ç³»ä½œè€…

- GitHub: [@Alessandro-Pang](https://github.com/Alessandro-Pang)
- é¡¹ç›®ä¸»é¡µ: [https://github.com/Alessandro-Pang/short-link](https://github.com/Alessandro-Pang/short-link)
- é—®é¢˜åé¦ˆ: [https://github.com/Alessandro-Pang/short-link/issues](https://github.com/Alessandro-Pang/short-link/issues)
